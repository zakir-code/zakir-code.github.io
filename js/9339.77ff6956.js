"use strict";(self["webpackChunkping_wallet"]=self["webpackChunkping_wallet"]||[]).push([[9339],{39339:function(t,e,s){s.r(e),s.d(e,{default:function(){return T}});var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"px-0"},[s("b-tabs",[s("b-tab",{attrs:{title:"Group By Validator"}},[s("b-card",[s("b-alert",{attrs:{variant:"danger",show:t.syncing}},[s("div",{staticClass:"alert-body"},[s("span",[t._v("No new blocks have been produced since "),s("strong",[t._v(t._s(t.latestTime))])])])]),s("b-card",{staticClass:"mb-1",attrs:{"no-body":""}},[s("b-row",[s("b-col",{attrs:{md:"3"}},[s("h4",[t._v("#"+t._s(t.height))])]),s("b-col",{attrs:{md:"9"}},[s("b-input-group",[s("b-input-group-prepend",{attrs:{"is-text":""}},[s("b-form-checkbox",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"Only missed blocks",name:"viewMissed"},model:{value:t.missedFilter,callback:function(e){t.missedFilter=e},expression:"missedFilter"}})],1),s("b-form-input",{attrs:{placeholder:"Keywords to filter validators"},model:{value:t.query,callback:function(e){t.query=e},expression:"query"}}),s("b-input-group-append",[s("b-button",{attrs:{to:"./uptime/my",variant:"primary"}},[t._v(" Favorite ")])],1)],1)],1)],1)],1),s("b-row",t._l(t.uptime,(function(e,o){return s("b-col",{key:o,staticClass:"text-truncate",attrs:{sm:"12",md:"4",xl:"3"}},[s("div",{staticClass:"d-flex justify-content-between"},[s("b-form-checkbox",{staticClass:"custom-control-warning text-truncate",attrs:{value:t.chain+"#"+e.address},on:{change:function(s){return t.pinValidator(t.chain+"#"+e.address)}},model:{value:t.pinned,callback:function(e){t.pinned=e},expression:"pinned"}},[s("span",{staticClass:"d-inline-block text-truncate font-weight-bold align-bottom"},[t._v(t._s(o+1)+" "+t._s(e.validator.moniker))])]),t.missing[e.address]?s("span",[t.missing[e.address].missed_blocks_counter>0?s("b-badge",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.v-danger",modifiers:{hover:!0,"v-danger":!0}}],staticClass:"text-danger text-bolder",attrs:{variant:"light-danger",title:t.missing[e.address].missed_blocks_counter+" missed blocks"}},[t._v(" "+t._s(t.missing[e.address].missed_blocks_counter)+" ")]):s("b-badge",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.v-success",modifiers:{hover:!0,"v-success":!0}}],attrs:{variant:"light-success",title:"Perfect! No missed blocks"}},[t._v(" 0 ")])],1):t._e()],1),s("b-skeleton-wrapper",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"loading",fn:function(){return[s("b-skeleton",{attrs:{width:"100%"}})]},proxy:!0},{key:"default",fn:function(){return[s("div",{staticClass:"d-flex justify-content-between align-self-stretch flex-wrap"},t._l(t.blocks,(function(o,i){return s("div",{key:i,staticStyle:{width:"1.5%"}},[s("router-link",{attrs:{to:"./blocks/"+o.height}},[s("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.v-second",modifiers:{hover:!0,"v-second":!0}}],staticClass:"m-auto",class:o.sigs&&o.sigs[e.address]?o.sigs[e.address]:"bg-light-success",attrs:{title:o.height}},[t._v("Â ")])])],1)})),0)]},proxy:!0}],null,!0)})],1)})),1)],1)],1),s("b-tab",{attrs:{title:"Group By Proposer"}},[s("b-card",[s("b-row",[s("b-col",{attrs:{md:"3",sm:"12"}},[s("h4",[t._v("#"+t._s(t.height))])]),s("b-col",{attrs:{md:"3",sm:"12"}},[s("b-input-group",{attrs:{prepend:"Fetch Frequency"}},[s("b-form-select",{attrs:{id:"frequency",placeholder:"Frequency to fetch data"},on:{change:function(e){return t.onFrequencyChange()}},model:{value:t.frequency,callback:function(e){t.frequency=e},expression:"frequency"}},[s("b-form-select-option",{attrs:{value:"6000"}},[t._v(" 6s ")]),s("b-form-select-option",{attrs:{value:"2000"}},[t._v(" 2s ")]),s("b-form-select-option",{attrs:{value:"1000"}},[t._v(" 1s ")])],1)],1)],1),s("b-col",{attrs:{sm:"12",md:"6"}},[s("b-input-group",{attrs:{prepend:"Qty of absent validators"}},[s("b-form-input",{attrs:{id:"threshold",placeholder:"Absent validator number in blocks"},model:{value:t.threshold,callback:function(e){t.threshold=e},expression:"threshold"}})],1)],1)],1)],1),s("b-row",t._l(t.proposerViewData,(function(e,o){return s("b-col",{key:o,staticClass:"text-truncate",attrs:{md:"4",sm:"12"}},[t._v(" "+t._s(e.name)+" "),e.proposed>0?s("b-badge",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.v-second",modifiers:{hover:!0,"v-second":!0}}],attrs:{title:e.proposed>0?Number(e.counter/e.proposed*100).toFixed(2)+" %":"",variant:e.counter>0?"light-danger":"light-success"}},[t._v(" "+t._s(e.counter)+" / "+t._s(e.proposed)+" ")]):t._e()],1)})),1)],1)],1)],1)},i=[],r=s(26253),a=s(50725),n=s(22183),l=s(90224),c=s(8775),d=s(73106),h=s(15193),u=s(26034),p=s(65098),b=s(90895),m=s(78959),g=s(4060),v=s(14777),f=s(46499),k=s(27754),_=s(22418),y=s(58887),B=s(51015),x=s(5870),w=s(54333),C=s(28972),F={components:{BRow:r.T,BCol:a.l,BFormInput:n.e,BFormGroup:l.x,BCard:c._,BAlert:d.F,BButton:h.T,BBadge:u.k,BFormCheckbox:p.l,BFormSelect:b.K,BFormSelectOption:m.c,BInputGroup:g.w,BSkeleton:v.u,BSkeletonWrapper:f.x,BInputGroupPrepend:k.P,BInputGroupAppend:_.B,BTabs:y.M,BTab:B.L},directives:{"b-tooltip":x.o},data(){const{chain:t}=this.$route.params,e=localStorage.getItem("pinned")?localStorage.getItem("pinned").split(","):"";return{height:0,loading:!0,missedFilter:!1,pinned:e,chain:t,query:"",validators:[],missing:{},blocks:Array.from("0".repeat(50)).map((t=>({sigs:{},height:Number(t)}))),syncing:!1,latestTime:"",threshold:10,proposers:{},absentValsInBlock:{},numOfBlock:1e3,temp:0,frequency:6e3}},computed:{uptime(){const t=this.query?this.validators.filter((t=>String(t.description.moniker).indexOf(this.query)>-1)):this.validators;t.sort(((t,e)=>e.delegator_shares-t.delegator_shares));const e=t.map((t=>({validator:t.description,address:this.hex2base64((0,w.consensusPubkeyToHexAddress)(t.consensus_pubkey))})));return this.missedFilter?e.filter((t=>this.missing[t.address].missed_blocks_counter>0)):e},proposerViewData(){const t={};return this.validators.forEach((e=>{t[this.hex2base64((0,w.consensusPubkeyToHexAddress)(e.consensus_pubkey))]={name:e.description.moniker,counter:0,proposed:0}})),Object.keys(this.proposers).forEach((e=>{const s=this.absentValsInBlock[e]||0;t[this.proposers[e]]&&(s>this.threshold&&(t[this.proposers[e]].counter+=1),t[this.proposers[e]].proposed+=1)})),Object.values(t).sort(((t,e)=>e.counter-t.counter))}},created(){const t=JSON.parse((0,w.getCachedValidators)(this.$route.params.chain));t&&(this.validators=t),this.$http.getValidatorList().then((t=>{this.validators=t})),this.$http.getSlashingSigningInfo().then((t=>{t.info&&t.info.forEach((t=>{if(t.address){const e=(0,C.toBase64)((0,C.fromBech32)(t.address).data);this.missing[e]=t}}))})),this.initBlocks()},beforeDestroy(){this.blocks=[],this.syncing=!1,clearInterval(this.timer)},methods:{pinValidator(){localStorage.setItem("pinned",this.pinned)},initBlocks(){this.$http.getLatestBlock().then((t=>{const{height:e}=t.block.last_commit;(0,w.timeIn)(t.block.header.time,3,"m")?this.syncing=!0:this.syncing=!1,this.latestTime=(0,w.toDay)(t.block.header.time,"long");const s=[];let o=Promise.resolve();for(let r=e-1;r>e-50;r-=1)s.unshift({sigs:{},height:r>0?r:0}),r>e-48&&r>0&&(o=o.then((()=>new Promise((t=>{this.fetch_status(r,t)})))));const i=this.initColor();t.block.last_commit.signatures.forEach((t=>{t.validator_address&&(i[t.validator_address]="bg-success")})),s.push({sigs:i,height:e}),this.blocks=s,this.timer=setInterval(this.fetch_latest,this.frequency),this.loading=!1}))},initColor(){const t={};return this.validators.forEach((e=>{t[this.hex2base64((0,w.consensusPubkeyToHexAddress)(e.consensus_pubkey))]="bg-danger"})),t},onFrequencyChange(){clearInterval(this.timer),this.timer=setInterval(this.fetch_latest,this.frequency)},hex2base64(t){return(0,C.toBase64)((0,C.fromHex)(t))},fetch_status(t,e){this.$http.getBlockByHeight(t).then((s=>{e();const o=this.blocks.find((e=>e.height===t));if(o){const t=this.initColor();s.block.last_commit.signatures.forEach((e=>{e.validator_address&&(t[e.validator_address]="bg-success")})),this.$set(o,"sigs",t)}this.count(s.block)}))},count(t){const e=t.last_commit.signatures.reduce(((t,e)=>"BLOCK_ID_FLAG_COMMIT"!==e.block_id_flag?t+1:t),0);this.$set(this.proposers,t.header.height,t.header.proposer_address),this.$set(this.absentValsInBlock,t.last_commit.height,e),e>=this.threshold&&(this.temp+=1)},fetch_latest(){this.$http.getLatestBlock().then((t=>{const e=this.initColor();t.block.last_commit.signatures.forEach((t=>{t.validator_address&&(e[t.validator_address]="bg-success")})),this.height=t.block.header.height;const s=this.blocks.find((e=>e.height===t.block.last_commit.height));"undefined"===typeof s&&(this.blocks.length>=50&&this.blocks.shift(),this.blocks.push({sigs:e,height:t.block.last_commit.height})),this.count(t.block)}))}}},I=F,q=s(1001),S=(0,q.Z)(I,o,i,!1,null,null,null),T=S.exports}}]);